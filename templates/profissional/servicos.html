<!DOCTYPE html>
<html lang="pt-br" class="bg-gray-50 font-sans text-gray-800">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Meus Servi√ßos - AgendeJ√°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../../static/js/login.js"></script>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="../../static/imgs/Miniatura.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        .group:hover .group-hover\:block {
            display: block;
        }

        @media (max-width: 768px) {
            .servico-card {
                border-left: 4px solid #3b82f6;
            }
        }

        .servico-item {
            transition: all 0.3s ease;
        }

        .servico-item:hover {
            background-color: #f9fafb;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
<!-- Cabe√ßalho -->
<header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center">
            <a href="/"><img src="../../static/imgs/Logo.png" alt="Logo AgendeJ√°" class="h-12 w-auto"/></a>
        </div>
        <nav class="hidden md:flex space-x-6">
            <a href="/servicosProfissional" class="text-gray-600 hover:text-blue-600">Servi√ßos</a>
            <a href="/agendamentos" class="text-gray-600 hover:text-blue-600">Agendamentos</a>
            <a href="/sobre" class="text-gray-600 hover:text-blue-600">Sobre N√≥s</a>
            <a href="/contato" class="text-gray-600 hover:text-blue-600">Contato</a>
        </nav>
        <!-- √Årea de Perfil -->
        <div class="flex items-center space-x-4">
            <div class="relative user-dropdown-container">
                <button class="dropdown-toggle flex items-center space-x-2 focus:outline-none transition-all duration-200 hover:bg-gray-50 rounded-lg px-3 py-2">
                    <img src="/imagemProfissional/{{ profissional[0] }}"
                         alt="Foto de perfil"
                         class="w-10 h-10 rounded-full border-2 border-blue-500 object-cover shadow-sm">
                    <span class="text-gray-700 font-medium">
                        {% if profissional[2] is none %}
                            {{ profissional[1] }}
                        {% else %}
                            {{ profissional[2] }}
                        {% endif %}</span>
                    <svg class="dropdown-arrow w-4 h-4 text-gray-600 transition-transform duration-200"
                         fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl py-2 z-50 border border-gray-100 hidden opacity-0 transform -translate-y-2 transition-all duration-200">
                    <div class="px-4 py-3 border-b border-gray-100">
                        <p class="text-sm font-medium text-gray-900">{{ profissional [1] }}</p>
                        <p class="text-sm text-gray-500 truncate">{{ profissional[5] }}</p>
                    </div>
                    <div class="border-t border-gray-100 pt-2">
                        <a href="/logout"
                           class="dropdown-item flex items-center px-4 py-3 text-red-600 hover:bg-red-50 transition-colors duration-150 group">
                            <span class="w-5 mr-3">üö™</span>
                            <span>Sair da conta</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <button class="md:hidden text-gray-600" onclick="toggleMobileMenu()">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <!-- Menu Mobile -->
    <div id="mobileMenu" class="hidden md:hidden bg-white py-4 px-4 border-t">
        <nav class="flex flex-col space-y-4">
            <a href="/" class="text-gray-600 hover:text-blue-600">Painel</a>
            <a href="/agendamentos" class="text-gray-600 hover:text-blue-600">Agendamentos</a>
            <a href="/sobre" class="text-gray-600 hover:text-blue-600">Sobre N√≥s</a>
            <a href="/contato" class="text-gray-600 hover:text-blue-600">Contato</a>
            <div class="border-t pt-4">
                <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium">Entrar</a>
                <a href="/cadastro"
                   class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition inline-block mt-2">Cadastre-se</a>
            </div>
        </nav>
    </div>
</header>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="flash-messages" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
            {% for message in messages %}
                <div class="alert alert-success"
                     style="background: #4CAF50; color: white; padding: 15px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<!-- Conte√∫do Principal -->
<main class="flex-grow container mx-auto px-4 py-6 md:py-8">
    <div class="max-w-6xl mx-auto">

        <!-- Cabe√ßalho da P√°gina -->
        <div class="bg-white rounded-lg shadow-sm p-4 md:p-6 mb-4 md:mb-6">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center">
                <div class="mb-4 md:mb-0">
                    <h1 class="text-xl md:text-2xl font-bold text-gray-800">Meus Servi√ßos</h1>
                    <p class="text-gray-600 text-sm md:text-base">Gerencie os servi√ßos que voc√™ oferece</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="abrirModalNovoServico()"
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i> Novo Servi√ßo
                    </button>
                </div>
            </div>
        </div>

        <!-- Lista de Servi√ßos - Mobile -->
        <div class="md:hidden space-y-4">
            <!-- Servi√ßo 1 -->

            {% for servico in servicos %}
                <div class="servico-card bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-900 text-lg">{{ servico[2] }}</h3>
                            <p class="text-gray-600 text-sm mt-1">{{ servico[3] }}</p>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-green-600 text-lg">R$ {{ servico[5] }}</div>
                            <div class="text-gray-500 text-sm mt-1">{{ servico[4] }} min</div>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mt-4 pt-3 border-t border-gray-200">
                        <div class="flex space-x-2">
                            <button class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                    title="Excluir">
                                <a href="/delServico/{{ servico[0] }}"><i class="fas fa-trash"></i></a>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>

        <!-- Lista de Servi√ßos - Desktop -->
        <div class="hidden md:block bg-white rounded-lg shadow-sm overflow-hidden">
            <!-- Cabe√ßalho da Tabela -->
            <div class="grid grid-cols-12 gap-4 px-6 py-4 bg-gray-50 border-b border-gray-200 font-semibold text-gray-700 text-sm">
                <div class="col-span-4">Servi√ßo</div>
                <div class="col-span-3">Descri√ß√£o</div>
                <div class="col-span-1 text-center">Dura√ß√£o</div>
                <div class="col-span-2 text-right">Pre√ßo</div>
                <div class="col-span-2 text-center">A√ß√µes</div>
            </div>

            {% for servico in servicos %}
                <div class="servico-item grid grid-cols-12 gap-4 px-6 py-4 border-b border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="col-span-4">
                        <div class="font-medium text-gray-900">{{ servico[2] }}</div>
                    </div>
                    <div class="col-span-3">
                        <div class="text-sm text-gray-500">{{ servico[3] }}</div>
                    </div>
                    <div class="col-span-1 text-center">
                        <div class="text-gray-700">{{ servico[4] }} min</div>
                    </div>
                    <div class="col-span-2 text-right">
                        <div class="font-medium text-green-600">R$ {{ servico[5] }}</div>
                    </div>
                    <div class="col-span-2">
                        <div class="flex justify-center space-x-2">
                            <button onclick="abrirModalEditarServico({{ servico[0] }}, '{{ servico[2] }}', '{{ servico[3] }}', {{ servico[4] }}, {{ servico[5] }}, '/imagemServico/{{servico[0]}}')"
                                    class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                    title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                    title="Excluir">
                                <a href="/delServico/{{ servico[0] }}"><i class="fas fa-trash"></i></a>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</main>

<!-- Modal para Adicionar/Editar Servi√ßo -->
<div id="modalServico" class="modal">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitulo" class="text-xl font-bold text-gray-800">Novo Servi√ßo</h3>
                <button onclick="fecharModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="formServico" action="/servicosProfissional" method="post" enctype="multipart/form-data">
                <!-- Campo hidden para armazenar o ID do servi√ßo sendo editado -->
                <input type="hidden" id="servicoId" name="servicoId" value="">

                <div class="space-y-4">
                    <!-- Campo de Imagem - Layout vertical -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imagem do Servi√ßo</label>

                        <!-- Preview da imagem -->
                        <div class="mb-3 flex justify-center">
                            <div class="w-40 h-40 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center overflow-hidden">
                                <img id="previewImagem" src="" alt="Preview" class="hidden w-full h-full object-cover">
                                <span id="placeholderImagem" class="text-gray-400 text-sm text-center px-2">Nenhuma imagem selecionada</span>
                            </div>
                        </div>

                        <!-- Input de arquivo -->
                        <div>
                            <input type="file" id="imagemServico" name="imagemServico"
                                   accept="image/*"
                                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                                   onchange="previewImage(this)">
                            <p class="text-xs text-gray-500 mt-1">Formatos: JPG, PNG, GIF. Tamanho m√°ximo: 5MB</p>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Servi√ßo</label>
                        <input type="text" id="nomeServico" name="nomeServico"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                               required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                        <textarea id="descricaoServico" rows="3" name="descricaoServico"
                                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dura√ß√£o (minutos)</label>
                            <input type="number" id="duracaoServico" min="1" name="duracaoServico"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                                   required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                            <input type="number" id="precoServico" min="0" step="0.01" name="precoServico"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                                   required>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
                    <button type="button" onclick="fecharModal()"
                            class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Salvar
                    </button>
                </div>
            </form>

            <script>
                function previewImage(input) {
                    const preview = document.getElementById('previewImagem');
                    const placeholder = document.getElementById('placeholderImagem');

                    if (input.files && input.files[0]) {
                        const reader = new FileReader();

                        reader.onload = function (e) {
                            preview.src = e.target.result;
                            preview.classList.remove('hidden');
                            placeholder.classList.add('hidden');
                        }

                        reader.readAsDataURL(input.files[0]);
                    } else {
                        preview.classList.add('hidden');
                        placeholder.classList.remove('hidden');
                    }
                }

                // Fun√ß√£o para carregar imagem existente ao editar
                function carregarImagemExistente(urlImagem) {
                    const preview = document.getElementById('previewImagem');
                    const placeholder = document.getElementById('placeholderImagem');

                    if (urlImagem) {
                        preview.src = urlImagem;
                        preview.classList.remove('hidden');
                        placeholder.classList.add('hidden');
                    } else {
                        preview.classList.add('hidden');
                        placeholder.classList.remove('hidden');
                    }
                }
            </script>
        </div>
    </div>
</div>
<!-- Rodap√© -->
<footer class="bg-gray-800 text-white py-12">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <div class="flex items-center mb-4">
                    <img src="../../static/imgs/logoBrancaa.png" alt="Logo AgendeJ√°" class="h-10 w-auto"/>
                </div>
                <p class="text-gray-400">A maneira mais f√°cil de agendar servi√ßos profissionais.</p>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Links √öteis</h4>
                <ul class="space-y-2">
                    <li><a href="/" class="text-gray-400 hover:text-white">In√≠cio</a></li>
                    <li><a href="/servicos/1" class="text-gray-400 hover:text-white">Servi√ßos</a></li>
                    <li><a href="/profissionais/1" class="text-gray-400 hover:text-white">Profissionais</a></li>
                    <li><a href="/sobre" class="text-gray-400 hover:text-white">Sobre N√≥s</a></li>
                </ul>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Suporte</h4>
                <ul class="space-y-2">
                    <li><a href=./contato" class="text-gray-400 hover:text-white">Contato</a></li>
                    <li><a href="/contato" class="text-gray-400 hover:text-white">Perguntas Frequentes</a></li>
                </ul>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Redes Sociais</h4>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
            <p>&copy; 2023 AgendeJ√°. Todos os direitos reservados.</p>
        </div>
    </div>
</footer>



<script>
    // Modal functions
    function abrirModalNovoServico() {
        document.getElementById('modalTitulo').textContent = 'Novo Servi√ßo';
        document.getElementById('formServico').reset();
        document.getElementById('servicoId').value = ''; // Limpa o ID para novo servi√ßo

        // Limpa a preview da imagem para novo servi√ßo
        const preview = document.getElementById('previewImagem');
        const placeholder = document.getElementById('placeholderImagem');
        preview.src = '';
        preview.classList.add('hidden');
        placeholder.classList.remove('hidden');

        // Limpa o input de arquivo
        document.getElementById('imagemServico').value = '';

        document.getElementById('modalServico').classList.add('active');
    }

    function abrirModalEditarServico(id, nome, descricao, duracao, preco, imagemUrl = null) {
        document.getElementById('modalTitulo').textContent = 'Editar Servi√ßo';
        document.getElementById('servicoId').value = id;
        document.getElementById('nomeServico').value = nome;
        document.getElementById('descricaoServico').value = descricao;
        document.getElementById('duracaoServico').value = duracao;
        document.getElementById('precoServico').value = preco;

        // Se houver uma URL de imagem, carregar a imagem existente
        if (imagemUrl) {
            carregarImagemExistente(imagemUrl);
        } else {
            // Se n√£o houver imagem, mostrar o placeholder
            const preview = document.getElementById('previewImagem');
            const placeholder = document.getElementById('placeholderImagem');
            preview.src = '';
            preview.classList.add('hidden');
            placeholder.classList.remove('hidden');
        }

        // N√£o limpa o input de arquivo - permite manter ou substituir

        document.getElementById('modalServico').classList.add('active');
    }

    function fecharModal() {
        document.getElementById('modalServico').classList.remove('active');
    }

    // Fun√ß√£o para carregar imagem existente ao editar
    function carregarImagemExistente(urlImagem) {
        const preview = document.getElementById('previewImagem');
        const placeholder = document.getElementById('placeholderImagem');

        if (urlImagem) {
            preview.src = urlImagem;
            preview.classList.remove('hidden');
            placeholder.classList.add('hidden');

            // Adicionar tratamento de erro caso a imagem n√£o exista
            preview.onerror = function () {
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                console.error('Erro ao carregar imagem:', urlImagem);
            };
        } else {
            preview.classList.add('hidden');
            placeholder.classList.remove('hidden');
        }
    }

    function previewImage(input) {
        const preview = document.getElementById('previewImagem');
        const placeholder = document.getElementById('placeholderImagem');

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');
            }

            reader.readAsDataURL(input.files[0]);
        } else {
            // Se o usu√°rio cancelar a sele√ß√£o, voltar para a imagem existente (se houver)
            const servicoId = document.getElementById('servicoId').value;
            if (servicoId) {
                // Tentar recarregar a imagem existente se estiver editando
                const imagemExistente = preview.src;
                if (imagemExistente && imagemExistente !== window.location.href) {
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                } else {
                    preview.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                }
            } else {
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }
        }
    }
</script>