<!DOCTYPE html>
<html lang="pt-br" class="bg-gray-100 font-sans text-gray-800">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Agendar Servi칞o - AgendeJ치</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../static/js/login.js"></script>
    <link rel="icon" href="../static/imgs/Miniatura.png">
    <link rel="stylesheet" href="/static/styles.css">
    <!-- Font Awesome para 칤cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <!-- Flatpickr para sele칞칚o de data/hora -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
</head>
<body class="min-h-screen flex flex-col">
<script>
    const profissionalId = "{{ profissional[0] }}";
    const servicoId = "{{ servico[0] }}";
    const clienteId = "{{ cliente[0] if cliente else '' }}";
</script>
<!-- Cabe칞alho -->
<header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center">
            <a href="/"><img src="../../static/imgs/Logo.png" alt="Logo AgendeJ치" class="h-12 w-auto"/></a>
        </div>
        <nav class="hidden md:flex space-x-6">
            <a href="/servicos/1" class="text-gray-600 hover:text-blue-600">Servi칞os</a>
            <a href="/profissionais/1" class="text-gray-600 hover:text-blue-600">Profissionais</a>
            <a href="/sobre" class="text-gray-600 hover:text-blue-600">Sobre N칩s</a>
            <a href="/contato" class="text-gray-600 hover:text-blue-600">Contato</a>
        </nav>
        <!-- 츼rea de Login/Perfil -->
        <div class="flex items-center space-x-4">
            {% if cliente %}
                <div class="relative user-dropdown-container">
                    <button class="dropdown-toggle flex items-center space-x-2 focus:outline-none transition-all duration-200 hover:bg-gray-50 rounded-lg px-3 py-2">
                        <img src="/imagem/{{ cliente[0] }}"
                             alt="Foto de perfil"
                             class="w-10 h-10 rounded-full border-2 border-blue-500 object-cover shadow-sm">
                        <span class="text-gray-700 font-medium">{{ cliente[1] }}</span>
                        <svg class="dropdown-arrow w-4 h-4 text-gray-600 transition-transform duration-200"
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>

                    <div class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl py-2 z-50 border border-gray-100 hidden opacity-0 transform -translate-y-2 transition-all duration-200">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p class="text-sm font-medium text-gray-900">{{ cliente[1] }}</p>
                            <p class="text-sm text-gray-500 truncate">{{ cliente[3] if cliente[3] else 'Usu치rio' }}</p>
                        </div>

                        <div class="py-2">
                            <a href="/editarCliente"
                               class="dropdown-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-150 group">
                                <span class="w-5 mr-3">游녻</span>
                                <span>Meu Perfil</span>
                            </a>

                            <a href="/agendamentosCliente"
                               class="dropdown-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors duration-150 group">
                                <span class="w-5 mr-3">游늰</span>
                                <span>Meus Agendamentos</span>
                            </a>
                        </div>

                        <div class="border-t border-gray-100 pt-2">
                            <a href="/logout"
                               class="dropdown-item flex items-center px-4 py-3 text-red-600 hover:bg-red-50 transition-colors duration-150 group">
                                <span class="w-5 mr-3">游뛁</span>
                                <span>Sair da conta</span>
                            </a>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="flex items-center space-x-3">
                    <a href="/login"
                       class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200">Entrar</a>
                    <a href="/cadastro"
                       class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg">Cadastre-se</a>
                </div>
            {% endif %}
        </div>
        <button class="md:hidden text-gray-600" onclick="toggleMobileMenu()">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <!-- Menu Mobile -->
    <div id="mobileMenu" class="hidden md:hidden bg-white py-4 px-4 border-t">
        <nav class="flex flex-col space-y-4">
            <a href="/servicos/1" class="text-gray-600 hover:text-blue-600">Servi칞os</a>
            <a href="/profissionais/1" class="text-gray-600 hover:text-blue-600">Profissionais</a>
            <a href="/sobre" class="text-gray-600 hover:text-blue-600">Sobre N칩s</a>
            <a href="/contato" class="text-gray-600 hover:text-blue-600">Contato</a>
            <div class="border-t pt-4">
                <a href="/login" class="text-blue-600 hover:text-blue-800 font-medium">Entrar</a>
                <a href="/cadastro"
                   class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition inline-block mt-2">Cadastre-se</a>
            </div>
        </nav>
    </div>
</header>

<!-- Breadcrumb -->
<section class="bg-gray-100 py-4">
    <div class="container mx-auto px-4">
        <nav class="flex" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="/login" class="text-sm text-gray-600 hover:text-blue-600">In칤cio</a>
                </li>
                <li class="inline-flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                    <a href="/servicos/1" class="text-sm text-gray-600 hover:text-blue-600">Servi칞os</a>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                        <span class="text-sm font-medium text-blue-600">Agendamento</span>
                    </div>
                </li>
            </ol>
        </nav>
    </div>
</section>

<!-- Conte칰do Principal -->
<main class="flex-grow py-8">
    <div class="container mx-auto px-4">
        <h1 class="text-3xl font-bold text-center mb-8">Agendar Servi칞o</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Resumo do Servi칞o -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
                    <h2 class="text-xl font-bold mb-4">Resumo do Servi칞o</h2>
                    <div class="flex items-start mb-4">
                        <img src="/imagemServico/{{ servico[0] }}"
                             alt="{{ servico[2] }}" class="w-20 h-20 object-cover rounded-lg mr-4">
                        <div>
                            <h3 class="font-bold">{{ servico[2] }}</h3>
                            <p class="text-sm text-gray-600">{{ profissional[1] }}</p>
                            <p class="text-sm text-gray-600">Dura칞칚o: {{ servico[4] }} min</p>
                        </div>
                    </div>
                    <div class="border-t border-gray-200 pt-4">
                        {#                        <div class="flex justify-between mb-2">#}
                        {#                            <span>Valor do servi칞o:</span>#}
                        {#                            <span class="font-bold">R$ 35,00</span>#}
                        {#                        </div>#}
                        {#                        <div class="flex justify-between mb-2">#}
                        {#                            <span>Taxa de reserva:</span>#}
                        {#                            <span class="font-bold">R$ 5,00</span>#}
                        {#                        </div>#}
                        <div class="flex justify-between text-lg font-bold mt-4 pt-4 border-t border-gray-200">
                            <span>Total:</span>
                            <span class="text-blue-600">R$ {{ servico[5] }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formul치rio de Agendamento -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold mb-6">Escolha a data e hor치rio</h2>

                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Selecione a data:</label>
                        <input type="text" id="datepicker"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Selecione uma data">
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Selecione o hor치rio:</label>
                        <div id="time-slots" class="grid grid-cols-4 gap-2">
                            <!-- Hor치rios ser칚o carregados via JavaScript -->
                            <p class="text-gray-500 col-span-4 text-center py-4">Selecione uma data para ver os hor치rios
                                dispon칤veis</p>
                        </div>
                    </div>
                </div>

                <!-- Finaliza칞칚o -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <button id="confirm-booking"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed">
                        Confirmar Agendamento
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modal de Confirma칞칚o -->
<div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-md w-full">
        <div class="text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold mb-2">Agendamento Confirmado!</h3>
            <p class="text-gray-600 mb-4">Seu agendamento foi realizado com sucesso.</p>
            <div class="bg-gray-100 p-4 rounded-lg mb-4 text-left">
                <p class="font-bold">Corte de Cabelo</p>
                <p class="text-sm"><span id="confirmed-date">25/11/2023</span> 맙 <span id="confirmed-time">14:00</span>
                </p>
            </div>
            <p class="text-sm text-gray-600 mb-4">Enviamos um e-mail com os detalhes do agendamento.</p>
            <div class="flex space-x-4">
                <button id="close-modal"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition">
                    Fechar
                </button>
                <a href="login.html"
                   class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg text-center transition">
                    P치gina Inicial
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Rodap칠 -->
<footer class="bg-gray-800 text-white py-12">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <div class="flex items-center mb-4">
                    <img src="../../static/imgs/logoBrancaa.png" alt="Logo AgendeJ치" class="h-10 w-auto"/>
                </div>
                <p class="text-gray-400">A maneira mais f치cil de agendar servi칞os profissionais.</p>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Links 칔teis</h4>
                <ul class="space-y-2">
                    <li><a href="/" class="text-gray-400 hover:text-white">In칤cio</a></li>
                    <li><a href="/servicos/1" class="text-gray-400 hover:text-white">Servi칞os</a></li>
                    <li><a href="/profissionais/1" class="text-gray-400 hover:text-white">Profissionais</a></li>
                    <li><a href="/sobre" class="text-gray-400 hover:text-white">Sobre N칩s</a></li>
                </ul>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Suporte</h4>
                <ul class="space-y-2">
                    <li><a href=./contato" class="text-gray-400 hover:text-white">Contato</a></li>
                    <li><a href="/contato" class="text-gray-400 hover:text-white">Perguntas Frequentes</a></li>
                </ul>
            </div>

            <div>
                <h4 class="text-lg font-bold mb-4">Redes Sociais</h4>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
            <p>&copy; 2023 AgendeJ치. Todos os direitos reservados.</p>
        </div>
    </div>
</footer>

<!-- Scripts -->
<script>
    // Inicializar datepicker
    const datepicker = flatpickr("#datepicker", {
        locale: "pt",
        minDate: "today",
        dateFormat: "d/m/Y",
        disableMobile: true,
        onChange: function (selectedDates, dateStr, instance) {
            updateTimeSlots(dateStr);
        }
    });

    // Buscar hor치rios dispon칤veis do backend
    async function updateTimeSlots(date) {
        const timeSlotsContainer = document.getElementById('time-slots');
        timeSlotsContainer.innerHTML = '<p class="text-gray-500 col-span-4 text-center py-4">Carregando hor치rios dispon칤veis...</p>';

        try {
            // Formatar data para o formato YYYY-MM-DD
            const [day, month, year] = date.split('/');
            const formattedDate = `${year}-${month}-${day}`;

            // Fazer requisi칞칚o para o backend
            const response = await fetch(`/horarios-disponiveis?data=${formattedDate}&profissional_id=${profissionalId}&servico_id=${servicoId}`);
            const horariosDisponiveis = await response.json();

            timeSlotsContainer.innerHTML = '';

            if (horariosDisponiveis.length === 0) {
                timeSlotsContainer.innerHTML = '<p class="text-gray-500 col-span-4 text-center py-4">Nenhum hor치rio dispon칤vel para esta data</p>';
                return;
            }

            horariosDisponiveis.forEach(horario => {
                const timeSlot = document.createElement('button');
                timeSlot.type = 'button';
                timeSlot.className = 'py-2 px-3 border border-gray-300 rounded-lg text-sm hover:bg-blue-100 hover:border-blue-500 transition time-slot';
                timeSlot.textContent = horario;
                timeSlot.dataset.horario = horario;

                timeSlot.addEventListener('click', function () {
                    document.querySelectorAll('.time-slot').forEach(slot => {
                        slot.classList.remove('bg-blue-500', 'text-white', 'border-blue-500');
                    });
                    this.classList.add('bg-blue-500', 'text-white', 'border-blue-500');
                });

                timeSlotsContainer.appendChild(timeSlot);
            });

        } catch (error) {
            console.error('Erro ao carregar hor치rios:', error);
            timeSlotsContainer.innerHTML = '<p class="text-red-500 col-span-4 text-center py-4">Erro ao carregar hor치rios dispon칤veis</p>';
        }
    }

    // Confirmar agendamento
    document.getElementById('confirm-booking').addEventListener('click', async function () {
        const isDateSelected = datepicker.selectedDates.length > 0;
        const isTimeSelected = document.querySelector('.time-slot.bg-blue-500') !== null;

        if (isDateSelected && isTimeSelected) {
            const selectedDate = datepicker.selectedDates[0];
            const formattedDate = selectedDate.toISOString().split('T')[0]; // YYYY-MM-DD
            const selectedTime = document.querySelector('.time-slot.bg-blue-500').dataset.horario;

            try {
                const response = await fetch('/agendar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: formattedDate,
                        horario: selectedTime,
                        profissional_id: profissionalId,
                        servico_id: servicoId
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Atualizar modal com informa칞칫es reais
                    document.getElementById('confirmed-date').textContent = selectedDate.toLocaleDateString('pt-BR');
                    document.getElementById('confirmed-time').textContent = selectedTime;
                    document.getElementById('confirmation-modal').classList.remove('hidden');
                } else {
                    alert('Erro ao agendar: ' + result.message);
                }

            } catch (error) {
                console.error('Erro ao agendar:', error);
                alert('Erro ao realizar agendamento');
            }
        } else {
            alert('Por favor, selecione uma data e um hor치rio para continuar.');
        }
    });

    // Fechar modal
    document.getElementById('close-modal').addEventListener('click', function () {
        document.getElementById('confirmation-modal').classList.add('hidden');
    });
</script>

</body>
</html>